(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["user"],{"520a":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"table-page-search-wrapper"},[a("a-form",{ref:"searchForm",attrs:{layout:"inline",form:e.form}},[a("a-row",{attrs:{gutter:20}},[e._l(e.searchFields,(function(t,r){return r<e.size?a("a-col",{key:r,attrs:{md:e.cmd,sm:24}},[a("a-form-item",{attrs:{label:t.name}},[t.type&&"input"!==t.type?"select"===t.type?a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{placeholder:"请选择"+t.name}},e._l(t.list,(function(t,r){return a("a-select-option",{key:r,attrs:{value:t.value?t.value:t.label}},[e._v(e._s(t.label?t.label:t.value)+" ")])})),1):"date"===t.type?a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{placeholder:"请选择"+t.name}}):"datetime"===t.type?a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{"show-time":"",placeholder:"请选择"+t.name}}):"radio"===t.type?a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}]},e._l(t.list,(function(t,r){return a("a-radio",{key:r,attrs:{value:t.value?t.value:t.label}},[e._v(" "+e._s(t.label?t.label:t.value)+" ")])})),1):[e._v("类型不支持")]:a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{placeholder:"请输入"+t.name},on:{pressEnter:e.handleSearch}})],2)],1):e._e()})),e.advanced?e._l(e.searchFields,(function(t,r){return r>=e.size?a("a-col",{key:r,attrs:{md:e.cmd,sm:24}},[a("a-form-item",{attrs:{label:t.name}},[t.type&&"input"!==t.type?"select"===t.type?a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{placeholder:"请选择"+t.name}},e._l(t.list,(function(t,r){return a("a-select-option",{key:r,attrs:{value:t.value?t.value:t.label}},[e._v(e._s(t.label?t.label:t.value)+" ")])})),1):"date"===t.type?a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{placeholder:"请选择"+t.name}}):"datetime"===t.type?a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{"show-time":"",placeholder:"请选择"+t.name}}):"radio"===t.type?a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}]},e._l(t.list,(function(t,r){return a("a-radio",{key:r,attrs:{value:t.value?t.value:t.label}},[e._v(" "+e._s(t.label?t.label:t.value)+" ")])})),1):[e._v("类型不支持")]:a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{placeholder:"请输入"+t.name},on:{pressEnter:e.handleSearch}})],2)],1):e._e()})):e._e(),e.searchFields.length>e.size?a("a-col",{attrs:{md:!e.advanced&&e.cmd||24,sm:24}},[a("span",{staticClass:"table-page-search-submitButtons",style:e.advanced&&{float:"right",overflow:"hidden"}||{}},[a("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),a("a-button",{staticStyle:{"margin-right":"10px"},on:{click:e.handleReset}},[e._v("重置")]),a("a",{staticStyle:{"margin-left":"8px"},on:{click:e.toggleAdvanced}},[e._v(" "+e._s(e.advanced?"收起":"展开")+" "),a("a-icon",{attrs:{type:e.advanced?"up":"down"}})],1)],1)]):a("a-col",{attrs:{md:e.cmd,sm:24}},[a("span",{staticClass:"table-page-search-submitButtons"},[a("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),a("a-button",{on:{click:e.handleReset}},[e._v("重置")])],1)])],2)],1)],1)},o=[],i=(a("d81d"),a("a9e3"),a("ca00")),s={name:"SearchForm",data:function(){return{form:this.$form.createForm(this),advanced:!1,dateFmt:"YYYY-MM-DD",datetimeFmt:"YYYY-MM-DD HH:mm:ss"}},props:{searchFields:{type:Array,required:!0},pmd:{type:Number,default:6}},computed:{cmd:function(){var e=this.pmd;return 6===e||8===e||12===e?e:6},size:function(){var e=this.pmd;return 6===e||8===e||12===e?24/e-1:3}},methods:{handleSearch:function(){var e=this,t=[],a=[];this.searchFields.map((function(e,r){"date"===e.type&&t.push(e.code),"datetime"===e.type&&a.push(e.code)}));var r=this.form.getFieldsValue();t.map((function(t){r[t]&&(r[t]=r[t].format(e.dateFmt))})),a.map((function(t){r[t]&&(r[t]=r[t].format(e.datetimeFmt))})),r=Object(i["b"])(r),this.$emit("search",r)},handleReset:function(){this.form.resetFields(),this.handleSearch()},toggleAdvanced:function(){this.advanced=!this.advanced}}},n=s,l=a("2877"),d=Object(l["a"])(n,r,o,!1,null,null,null);t["a"]=d.exports},8930:function(e,t,a){"use strict";a.d(t,"e",(function(){return i})),a.d(t,"a",(function(){return s})),a.d(t,"k",(function(){return n})),a.d(t,"h",(function(){return l})),a.d(t,"j",(function(){return d})),a.d(t,"i",(function(){return c})),a.d(t,"g",(function(){return m})),a.d(t,"f",(function(){return u})),a.d(t,"b",(function(){return p})),a.d(t,"c",(function(){return h})),a.d(t,"d",(function(){return f}));a("99af");var r=a("b775"),o={list:"/sys/user/list",add:"/sys/user/add",update:"/sys/user/update",remove:"/sys/user/remove",toggleState:"/sys/user/toggle-state",resetPwd:"/sys/user/reset-pwd",listNoRoles:"/sys/user/list-no-roles",listHaveRoles:"/sys/user/list-have-roles",addUserRoles:"/sys/user/add-user-roles",delUserRoles:"/sys/user/del-user-roles",detail:"/sys/user/detail"};function i(e){return Object(r["b"])({url:o.list,method:"post",data:e})}function s(e){return Object(r["b"])({url:o.add,method:"post",data:e})}function n(e,t){return Object(r["b"])({url:"".concat(o.update,"/").concat(e),method:"post",data:t})}function l(e){return Object(r["b"])({url:"".concat(o.remove,"/").concat(e),method:"get"})}function d(e){return Object(r["b"])({url:"".concat(o.toggleState,"/").concat(e),method:"get"})}function c(e){return Object(r["b"])({url:"".concat(o.resetPwd,"/").concat(e),method:"get"})}function m(e,t){return Object(r["b"])({url:"".concat(o.listNoRoles,"/").concat(e),method:"post",data:t})}function u(e,t){return Object(r["b"])({url:"".concat(o.listHaveRoles,"/").concat(e),method:"post",data:t})}function p(e,t){return Object(r["b"])({url:"".concat(o.addUserRoles,"/").concat(e),method:"post",data:t})}function h(e,t){return Object(r["b"])({url:"".concat(o.delUserRoles,"/").concat(e),method:"post",data:t})}function f(e){return Object(r["b"])({url:"".concat(o.detail,"/").concat(e),method:"get"})}},9873:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-form-item",e._b({attrs:{label:e.itemLabel}},"a-form-item",e.formItemLayout,!1),[a("a-upload",{directives:[{name:"decorator",rawName:"v-decorator",value:["imgFile",{rules:[{required:e.mustUpload,validator:e.fileRequiredValidator}]}],expression:"['imgFile',{ rules: [{required:mustUpload, validator: fileRequiredValidator }]}]"}],staticClass:"avatar-uploader",attrs:{name:"file",accept:"image/*",headers:e.uploadHeaders,listType:"picture-card",showUploadList:!1,action:e.fileServer+"/file/upload",beforeUpload:e.handleBeforeUpload},on:{change:e.handleUploadChange}},[e.imgPath?a("img",{style:{width:"100%"},attrs:{src:this.fileServer+"/"+e.imgPath,alt:"upload image"}}):a("div",[a("a-icon",{attrs:{type:e.loading?"loading":"plus"}}),a("div",{staticClass:"ant-upload-text"},[e._v("上传")])],1)])],1)},o=[],i=a("8bbf"),s=a.n(i),n=a("9fb0"),l={name:"ImgUpload",data:function(){return{uploadHeaders:{authorization:s.a.ls.get(n["a"])},loading:!1}},activated:function(){},props:{mustUpload:{type:Boolean,default:!0},itemLabel:{type:String,default:"图片"},imgPath:{type:String,default:""},formItemLayout:{type:Object,default:function(){return{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}}},methods:{fileRequiredValidator:function(e,t,a){var r=this;this.mustUpload?this.$nextTick((function(){r.loading||r.imgPath?a():a(new Error("请选择图片上传"))})):a()},handleUploadChange:function(e){if("uploading"===e.file.status)return this.loading=!0,void this.$emit("update:imgPath","");"done"===e.file.status&&(this.loading=!1,e.file.response.status&&this.$emit("update:imgPath",e.file.response.data))},handleBeforeUpload:function(e){var t="image/jpeg"===e.type,a="image/png"===e.type;t||a||this.$message.error("仅能上传  JPG/PNG 文件!");var r=e.size/1024/1024<2;return r||this.$message.error("上传文件必须小于 2MB!"),(t||a)&&r}}},d=l,c=a("2877"),m=Object(c["a"])(d,r,o,!1,null,"7dd1c496",null);t["a"]=m.exports},e7ed:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("keep-alive",["User"===e.$route.name?a("a-card",{attrs:{bordered:!1}},[a("search-form",{attrs:{searchFields:e.searchFields},on:{search:e.handleSearchEvent}}),e.checkPermission(["sysUser:add"])?a("div",{staticClass:"table-operator"},[a("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.handleAdd}},[e._v("新增")])],1):e._e(),a("a-table",{attrs:{bordered:!1,columns:e.columns,loading:e.loading,size:e.tableSize,dataSource:e.data,pagination:e.pagination,rowKey:function(e){return e.id}},on:{change:e.handleChange},scopedSlots:e._u([{key:"avatar",fn:function(t){return[a("a-avatar",{attrs:{size:"small",src:e.fileServer+"/"+t}})]}},{key:"state",fn:function(e){return[a("a-badge","0"===e?{attrs:{status:"success"}}:{attrs:{status:"error"}})]}},{key:"action",fn:function(t){return[a("div",{staticClass:"row-operations"},[a("a-tooltip",{directives:[{name:"permission",rawName:"v-permission",value:["sysUser:toggle"],expression:"['sysUser:toggle']"}],attrs:{title:"0"===t.state?"启用":"禁用"}},[a("a-switch",{attrs:{size:"small",checked:"0"===t.state},on:{change:function(a){return e.toggleState(t)}}})],1),a("a-button",{directives:[{name:"permission",rawName:"v-permission",value:["sysUser:update"],expression:"['sysUser:update']"}],staticClass:"rowBtn",attrs:{size:"small",type:"link"},on:{click:function(a){return e.handleEdit(t)}}},[e._v("编辑")]),a("a-button",{directives:[{name:"permission",rawName:"v-permission",value:["sysUser:configRoles"],expression:"['sysUser:configRoles']"}],staticClass:"rowBtn",attrs:{type:"link",size:"small"},on:{click:function(a){return e.handleConfigRoles(t.id)}}},[e._v("配置角色")]),a("a-popconfirm",{directives:[{name:"permission",rawName:"v-permission",value:["sysUser:resetPwd"],expression:"['sysUser:resetPwd']"}],attrs:{placement:"top",title:"确定重置此用户密码吗？",trigger:"hover",okText:"是",cancelText:"否"},on:{confirm:function(a){return e.handleResetPwd(t.id)}}},[a("a-button",{staticClass:"rowBtn",attrs:{type:"link",size:"small"}},[e._v("重置密码")])],1),a("a-popconfirm",{directives:[{name:"permission",rawName:"v-permission",value:["sysUser:remove"],expression:"['sysUser:remove']"}],attrs:{placement:"top",title:"确定删除此数据吗？",trigger:"hover",okText:"是",cancelText:"否"},on:{confirm:function(a){return e.handleRemove(t.id)}}},[a("a-button",{staticClass:"rowBtn",attrs:{type:"link",size:"small"}},[e._v("删除")])],1)],1)]}}],null,!1,4253424107)}),a("a-modal",{attrs:{visible:e.modal.visible,title:e.modal.title,confirmLoading:e.modal.confirmLoading},on:{cancel:e.handleModalCancel,ok:e.handleModalOk}},[a("a-form",{attrs:{form:e.form}},[a("a-form-item",e._b({attrs:{label:"用户名"}},"a-form-item",e.modal.formItemLayout,!1),[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["id",{rules:[{required:!0,message:"请输入用户名!"}]}],expression:"['id',{ rules: [{ required: true, message: '请输入用户名!' }]} ]"}],attrs:{disabled:"edit"===e.modal.mode}})],1),a("a-form-item",e._b({attrs:{label:"状态"}},"a-form-item",e.modal.formItemLayout,!1),[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["state",{rules:[{required:!0,message:"请选择状态!"}]}],expression:"['state',{ rules: [{ required: true, message: '请选择状态!' }]} ]"}]},[a("a-radio",{attrs:{value:"0"}},[e._v("启用")]),a("a-radio",{attrs:{value:"1"}},[e._v("禁用")])],1)],1),a("a-form-item",e._b({attrs:{label:"姓名/昵称"}},"a-form-item",e.modal.formItemLayout,!1),[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["nickname"],expression:"['nickname']"}]})],1),a("avatar-upload",{attrs:{imgPath:e.modal.form.avatar,itemLabel:"头像",formItemLayout:e.modal.formItemLayout},on:{"update:imgPath":function(t){return e.$set(e.modal.form,"avatar",t)},"update:img-path":function(t){return e.$set(e.modal.form,"avatar",t)}}}),a("a-form-item",e._b({attrs:{label:"手机号"}},"a-form-item",e.modal.formItemLayout,!1),[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["phone"],expression:"['phone']"}]})],1),a("a-form-item",e._b({attrs:{label:"邮箱"}},"a-form-item",e.modal.formItemLayout,!1),[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["email"],expression:"['email']"}]})],1),a("a-form-item",e._b({attrs:{label:"简介"}},"a-form-item",e.modal.formItemLayout,!1),[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["intro"],expression:"['intro']"}],attrs:{type:"textarea"}})],1)],1)],1)],1):e._e()],1),a("transition",{attrs:{name:"page-transition"}},[a("router-view")],1)],1)},o=[],i=(a("a4d3"),a("e01a"),a("4de4"),a("b0c0"),a("d3b7"),a("8930")),s=a("ca00"),n=a("9873"),l=a("520a"),d=Object(s["c"])();d.form.avatar="";var c={name:"User",components:{SearchForm:l["a"],AvatarUpload:n["a"]},data:function(){return{description:"",form:this.$form.createForm(this),loading:!1,columns:[{title:"状态",dataIndex:"state",align:"center",scopedSlots:{customRender:"state"}},{title:"头像",dataIndex:"avatar",align:"center",scopedSlots:{customRender:"avatar"}},{title:"用户名",dataIndex:"id"},{title:"昵称",dataIndex:"nickname"},{title:"简介",dataIndex:"intro"},{title:"电话",dataIndex:"phone",align:"left"},{title:"邮箱",dataIndex:"email",align:"left"},{title:"操作",key:"action",align:"right",scopedSlots:{customRender:"action"}}],data:[],searchFields:[{name:"用户名",code:"search_LIKE_id"},{name:"简介",code:"search_LIKE_intro"},{name:"电话",code:"search_LIKE_phone"},{name:"邮箱",code:"search_LIKE_email"}],pagination:{showSizeChanger:!0,total:0,current:1,pageSize:10},filter:{},modal:d}},watch:{$route:function(e,t){"UserConfigRoles"===e.name&&(this.description="左侧为 用户 ".concat(e.params.userId," 未拥有角色，右侧为已拥有角色")),"User"===e.name&&(this.description="")}},created:function(){this.loadData()},methods:{loadData:function(){var e=this;this.loading=!0;var t={filter:this.filter,current:this.pagination.current,pageSize:this.pagination.pageSize};Object(i["e"])(t).then((function(t){e.data=t.data.records,e.pagination.current=t.data.current,e.pagination.total=t.data.total,e.pagination.pageSize=t.data.pageSize})).finally((function(){e.loading=!1}))},handleSearchEvent:function(e){this.pagination.current=1,this.pagination.total=0,this.filter=e,this.loadData()},handleChange:function(e){this.pagination=e,this.loadData()},toggleState:function(e){var t=this;Object(i["j"])(e.id).then((function(e){e.status&&t.loadData()}))},handleAdd:function(){var e=this;this.modal.title="新增用户",this.modal.mode="add",this.modal.visible=!0,this.modal.form.avatar="",this.modal.form.avatarLoading=!1,this.$nextTick((function(){e.form.setFieldsValue({state:"0"})}))},handleEdit:function(e){var t=this;this.modal.title="编辑用户",this.modal.mode="edit",this.modal.visible=!0,this.modal.form.avatar=e.avatar,this.modal.form.avatarLoading=!1,this.$nextTick((function(){t.form.setFieldsValue({id:e.id,nickname:e.nickname,phone:e.phone,email:e.email,state:e.state,intro:e.intro})}))},handleConfigRoles:function(e){this.$router.push({name:"UserConfigRoles",params:{userId:e}})},handleResetPwd:function(e){var t=this;Object(i["i"])(e).then((function(e){e.status&&t.loadData()}))},handleRemove:function(e){var t=this;Object(i["h"])(e).then((function(e){e.status&&t.loadData()}))},handleModalOk:function(){var e=this;this.form.validateFields((function(t,a){t||(e.modal.confirmLoading=!0,delete a.imgFile,a.avatar=e.modal.form.avatar,"add"===e.modal.mode?Object(i["a"])(a).then(e.handleModalOkResult):"edit"===e.modal.mode&&Object(i["k"])(a.id,a).then(e.handleModalOkResult))}))},handleModalOkResult:function(e){this.modal.confirmLoading=!1,e.status&&(this.modal.visible=!1,this.form.resetFields(),this.loadData())},handleModalCancel:function(){this.form.resetFields(),this.modal.visible=!1}}},m=c,u=a("2877"),p=Object(u["a"])(m,r,o,!1,null,null,null);t["default"]=p.exports}}]);