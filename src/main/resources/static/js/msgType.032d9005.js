(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["msgType"],{"1afd":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"table-page-search-wrapper"},[a("a-form",{ref:"searchForm",attrs:{layout:"inline",form:e.form}},[a("a-row",{attrs:{gutter:20}},[e._l(e.searchFields,(function(t,r){return r<e.size?a("a-col",{key:r,attrs:{md:e.cmd,sm:24}},[a("a-form-item",{attrs:{label:t.name}},[t.type&&"input"!==t.type?"select"===t.type?a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{placeholder:"请选择"+t.name}},e._l(t.list,(function(t,r){return a("a-select-option",{key:r,attrs:{value:t.value?t.value:t.label}},[e._v(e._s(t.label?t.label:t.value)+" ")])})),1):"date"===t.type?a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{placeholder:"请选择"+t.name}}):"datetime"===t.type?a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{"show-time":"",placeholder:"请选择"+t.name}}):"radio"===t.type?a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}]},e._l(t.list,(function(t,r){return a("a-radio",{key:r,attrs:{value:t.value?t.value:t.label}},[e._v(" "+e._s(t.label?t.label:t.value)+" ")])})),1):[e._v("类型不支持")]:a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{placeholder:"请输入"+t.name},on:{pressEnter:e.handleSearch}})],2)],1):e._e()})),e.advanced?e._l(e.searchFields,(function(t,r){return r>=e.size?a("a-col",{key:r,attrs:{md:e.cmd,sm:24}},[a("a-form-item",{attrs:{label:t.name}},[t.type&&"input"!==t.type?"select"===t.type?a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{placeholder:"请选择"+t.name}},e._l(t.list,(function(t,r){return a("a-select-option",{key:r,attrs:{value:t.value?t.value:t.label}},[e._v(e._s(t.label?t.label:t.value)+" ")])})),1):"date"===t.type?a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{placeholder:"请选择"+t.name}}):"datetime"===t.type?a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{"show-time":"",placeholder:"请选择"+t.name}}):"radio"===t.type?a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}]},e._l(t.list,(function(t,r){return a("a-radio",{key:r,attrs:{value:t.value?t.value:t.label}},[e._v(" "+e._s(t.label?t.label:t.value)+" ")])})),1):[e._v("类型不支持")]:a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.code],expression:"[item.code]"}],attrs:{placeholder:"请输入"+t.name},on:{pressEnter:e.handleSearch}})],2)],1):e._e()})):e._e(),e.searchFields.length>e.size?a("a-col",{attrs:{md:!e.advanced&&e.cmd||24,sm:24}},[a("span",{staticClass:"table-page-search-submitButtons",style:e.advanced&&{float:"right",overflow:"hidden"}||{}},[a("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),a("a-button",{staticStyle:{"margin-right":"10px"},on:{click:e.handleReset}},[e._v("重置")]),a("a",{staticStyle:{"margin-left":"8px"},on:{click:e.toggleAdvanced}},[e._v(" "+e._s(e.advanced?"收起":"展开")+" "),a("a-icon",{attrs:{type:e.advanced?"up":"down"}})],1)],1)]):a("a-col",{attrs:{md:e.cmd,sm:24}},[a("span",{staticClass:"table-page-search-submitButtons"},[a("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),a("a-button",{on:{click:e.handleReset}},[e._v("重置")])],1)])],2)],1)],1)},o=[],i=(a("d81d"),a("a9e3"),a("4042")),s={name:"SearchForm",data:function(){return{form:this.$form.createForm(this),advanced:!1,dateFmt:"YYYY-MM-DD",datetimeFmt:"YYYY-MM-DD HH:mm:ss"}},props:{searchFields:{type:Array},pmd:{type:Number,default:6}},computed:{cmd:function(){var e=this.pmd;return 6===e||8===e||12===e?e:6},size:function(){var e=this.pmd;return 6===e||8===e||12===e?24/e-1:3}},methods:{handleSearch:function(){var e=this,t=[],a=[];this.searchFields.map((function(e,r){"date"===e.type&&t.push(e.code),"datetime"===e.type&&a.push(e.code)}));var r=this.form.getFieldsValue();t.map((function(t){r[t]&&(r[t]=r[t].format(e.dateFmt))})),a.map((function(t){r[t]&&(r[t]=r[t].format(e.datetimeFmt))})),r=Object(i["b"])(r),this.$emit("search",r)},handleReset:function(){this.form.resetFields(),this.handleSearch()},toggleAdvanced:function(){this.advanced=!this.advanced}}},n=s,l=a("2877"),d=Object(l["a"])(n,r,o,!1,null,null,null);t["a"]=d.exports},2312:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-form-item",e._b({attrs:{label:e.itemLabel}},"a-form-item",e.formItemLayout,!1),[a("a-upload",{directives:[{name:"decorator",rawName:"v-decorator",value:["imgFile",{rules:[{required:e.mustUpload,validator:e.fileRequiredValidator}]}],expression:"['imgFile',{ rules: [{required:mustUpload, validator: fileRequiredValidator }]}]"}],staticClass:"avatar-uploader",attrs:{name:"file",accept:"image/*",headers:e.uploadHeaders,listType:"picture-card",showUploadList:!1,action:e.fileServer+"/file/upload",beforeUpload:e.handleBeforeUpload},on:{change:e.handleUploadChange}},[e.imgPath?a("img",{style:{width:"100%"},attrs:{src:this.fileServer+"/"+e.imgPath,alt:"upload image"}}):a("div",[a("a-icon",{attrs:{type:e.loading?"loading":"plus"}}),a("div",{staticClass:"ant-upload-text"},[e._v("上传")])],1)])],1)},o=[],i=a("8bbf"),s=a.n(i),n=a("9fb0"),l={name:"ImgUpload",data:function(){return{uploadHeaders:{authorization:s.a.ls.get(n["a"])},loading:!1}},activated:function(){},props:{mustUpload:{type:Boolean,default:!0},itemLabel:{type:String,default:"图片"},imgPath:{type:String},formItemLayout:{type:Object,default:function(){return{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}}}},methods:{fileRequiredValidator:function(e,t,a){var r=this;this.mustUpload?this.$nextTick((function(){r.loading||r.imgPath?a():a(new Error("请选择图片上传"))})):a()},handleUploadChange:function(e){if("uploading"===e.file.status)return this.loading=!0,void this.$emit("update:imgPath","");"done"===e.file.status&&(this.loading=!1,e.file.response.status&&this.$emit("update:imgPath",e.file.response.data))},handleBeforeUpload:function(e){var t="image/jpeg"===e.type,a="image/png"===e.type;t||a||this.$message.error("仅能上传  JPG/PNG 文件!");var r=e.size/1024/1024<2;return r||this.$message.error("上传文件必须小于 2MB!"),(t||a)&&r}}},d=l,c=a("2877"),u=Object(c["a"])(d,r,o,!1,null,"2ddf039e",null);t["a"]=u.exports},4042:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return s}));a("d81d"),a("b64b"),a("498a");function r(e){return void 0===e||null===e||""===e.trim()}function o(e){return!r(e)}function i(e){var t={};for(var a in e)o(e[a])&&(t[a]=e[a]);return t}var s=function(){return{title:"",mode:"",visible:!1,formItemLayout:{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}},confirmLoading:!1,form:{}}}},"9e6f":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",{attrs:{bordered:!1}},[a("search-form",{attrs:{searchFields:e.searchFields},on:{search:e.handleSearchEvent}}),a("div",{staticClass:"table-operator"},[a("a-button",{directives:[{name:"action",rawName:"v-action:sysUser:add",arg:"sysUser:add"}],attrs:{type:"primary",icon:"plus"},on:{click:e.handleAdd}},[e._v("新增")])],1),a("a-table",{attrs:{bordered:!1,columns:e.columns,loading:e.loading,defaultExpandAllRows:!0,dataSource:e.data,pagination:e.pagination,rowKey:function(e){return e.id}},on:{change:e.handleChange},scopedSlots:e._u([{key:"logo",fn:function(t){return[a("a-avatar",{attrs:{src:e.fileServer+"/"+t}})]}},{key:"state",fn:function(e){return[a("a-badge","ON"===e?{attrs:{status:"success"}}:{attrs:{status:"error"}})]}},{key:"action",fn:function(t){return[a("div",{staticClass:"row-operations"},[a("a-tooltip",{directives:[{name:"action",rawName:"v-action:sysMsgType:toggle",arg:"sysMsgType:toggle"}],attrs:{title:"ON"===t.state?"启用":"禁用"}},[a("a-switch",{attrs:{size:e.rowBtnSize,checked:"ON"===t.state},on:{change:function(a){return e.toggleState(t)}}})],1),a("a-button",{directives:[{name:"action",rawName:"v-action:sysMsgType:update",arg:"sysMsgType:update"}],staticClass:"rowBtn",attrs:{size:e.rowBtnSize,type:"link"},on:{click:function(a){return e.handleEdit(t)}}},[e._v(" 编辑 ")]),a("a-popconfirm",{directives:[{name:"action",rawName:"v-action:sysMsgType:remove",arg:"sysMsgType:remove"}],attrs:{placement:"top",title:"确定删除此数据吗？",trigger:"hover",okText:"是",cancelText:"否"},on:{confirm:function(a){return e.handleRemove(t.id)}}},[a("a-button",{staticClass:"rowBtn",attrs:{type:"link",size:e.rowBtnSize}},[e._v("删除 ")])],1)],1)]}}])}),a("a-modal",{attrs:{width:"640px",visible:e.modal.visible,title:e.modal.title,confirmLoading:e.modal.confirmLoading},on:{cancel:e.handleModalCancel,ok:e.handleModalOk}},[a("a-form",{attrs:{form:e.form}},[a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{xs:24}},[a("a-form-item",e._b({attrs:{label:"编码"}},"a-form-item",e.formItemLayout,!1),[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["id",{rules:[{required:!0,message:"统一识别码!"}]}],expression:"['id',{ rules: [{ required: true, message: '统一识别码!' }]} ]"}],attrs:{disabled:"edit"===e.modal.mode}})],1)],1)],1),a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{xs:12}},[a("a-form-item",e._b({attrs:{label:"标题"}},"a-form-item",e.formItemLayout2,!1),[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入标题!"}]}],expression:"['name',{ rules: [{ required: true, message: '请输入标题!' }]}]"}]})],1)],1),a("a-col",{attrs:{xs:12}},[a("a-form-item",e._b({attrs:{label:"推送"}},"a-form-item",e.formItemLayout2,!1),[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["pushMode",{rules:[{required:!0,message:"请选择推送方式!"}]}],expression:"['pushMode',{ rules: [{ required: true, message: '请选择推送方式!' }]}]"}]},e._l(e.pushMode,(function(t,r){return a("a-select-option",{key:r,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1)],1)],1),a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{xs:12}},[a("avatar-upload",{attrs:{imgPath:e.modal.form.logo,itemLabel:"图标",formItemLayout:e.formItemLayout2},on:{"update:imgPath":function(t){return e.$set(e.modal.form,"logo",t)},"update:img-path":function(t){return e.$set(e.modal.form,"logo",t)}}})],1),a("a-col",{attrs:{xs:12}},[a("a-form-item",e._b({attrs:{label:"状态"}},"a-form-item",e.formItemLayout2,!1),[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["state",{rules:[{required:!0,message:"请选择状态!"}]}],expression:"['state',{ rules: [{ required: true, message: '请选择状态!' }]} ]"}]},[a("a-radio",{attrs:{value:"ON"}},[e._v("启用")]),a("a-radio",{attrs:{value:"OFF"}},[e._v("禁用")])],1)],1)],1)],1),a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{xs:12}},[a("a-form-item",e._b({attrs:{label:"过期"}},"a-form-item",e.formItemLayout2,!1),[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["expiry",{rules:[{required:!0,message:"请输入过期天数!"}]}],expression:"['expiry',{ rules: [{ required: true, message: '请输入过期天数!' }]}]"}],attrs:{min:0}})],1)],1),a("a-col",{attrs:{xs:12}},[a("a-form-item",e._b({attrs:{label:"作废"}},"a-form-item",e.formItemLayout2,!1),[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["dead",{rules:[{required:!0,message:"请输入作废天数!"}]}],expression:"['dead',{ rules: [{ required: true, message: '请输入作废天数!' }]}]"}],attrs:{min:0}})],1)],1)],1),a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{xs:24}},[a("a-form-item",e._b({attrs:{label:"模板"}},"a-form-item",e.formItemLayout,!1),[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["template",{rules:[{required:!0,message:"请输入模板!"}]}],expression:"['template',{ rules: [{ required: true, message: '请输入模板!' }]}]"}],attrs:{rows:4}})],1)],1)],1),a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{xs:24}},[a("a-form-item",e._b({attrs:{label:"备注"}},"a-form-item",e.formItemLayout,!1),[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["remark"],expression:"['remark']"}],attrs:{rows:3}})],1)],1)],1),a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{xs:24}},[a("a-form-item",e._b({attrs:{label:"接收者"}},"a-form-item",e.formItemLayout,!1),[a("tags-input",{attrs:{tags:e.modal.form.audience,confirmCallback:e.tagsInputConfirmCbk,btnText:"新受众"},on:{"update:tags":function(t){return e.$set(e.modal.form,"audience",t)}}})],1)],1)],1)],1)],1)],1)},o=[],i=(a("4de4"),a("b0c0"),a("d3b7"),a("ac1f"),a("1276"),a("2ca0"),a("99af"),a("b775")),s={list:"/sys/msg-type/list",add:"/sys/msg-type/add",update:"/sys/msg-type/update",remove:"/sys/msg-type/remove",toggleState:"/sys/msg-type/toggle-state"};function n(e){return Object(i["b"])({url:s.list,method:"post",data:e})}function l(e){return Object(i["b"])({url:s.add,method:"post",data:e})}function d(e,t){return Object(i["b"])({url:"".concat(s.update,"/").concat(e),method:"post",data:t})}function c(e){return Object(i["b"])({url:"".concat(s.remove,"/").concat(e),method:"get"})}function u(e){return Object(i["b"])({url:"".concat(s.toggleState,"/").concat(e),method:"get"})}var m=a("4042"),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._l(e.tags,(function(t){return a("a-tag",{key:t,attrs:{closable:"",afterClose:function(){return e.handleTagClose(t)}}},[e._v(" "+e._s(t)+" ")])})),e.inputVisible?a("a-input",{ref:"input",style:{width:e.inputWidth},attrs:{size:"small"},on:{blur:e.handleTagInputConfirm,pressEnter:e.handleTagInputConfirm},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):a("a-tag",{staticStyle:{background:"#fff",borderStyle:"dashed"},on:{click:e.showInput}},[a("a-icon",{attrs:{type:"plus"}}),e._v(" "+e._s(e.btnText)+" ")],1)],2)},f=[],h=(a("c975"),a("498a"),a("2909")),v={name:"TagsInput",data:function(){return{inputVisible:!1,inputValue:""}},props:{tags:{type:Array,default:function(){return[]}},btnText:{type:String,default:"新标签"},inputWidth:{type:String,default:"100px"},confirmCallback:{type:Function,default:function(e){return!0}},closeCallback:{type:Function,default:function(e){return!0}}},created:function(){},methods:{showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick((function(){e.$refs.input.focus()}))},handleTagClose:function(e){var t=this.tags.filter((function(t){return t!==e}));this.closeCallback(e),this.$emit("update:tags",t)},handleTagInputConfirm:function(){var e=this.inputValue.trim();e&&-1===this.tags.indexOf(e)&&this.confirmCallback(e)&&this.$emit("update:tags",[].concat(Object(h["a"])(this.tags),[e])),this.inputValue="",this.inputVisible=!1}}},g=v,b=a("2877"),y=Object(b["a"])(g,p,f,!1,null,"57fdada7",null),x=y.exports,_=a("2312"),w=a("1afd"),k=Object(m["a"])();k.form.logo="",k.form.audience=[];var S=[{label:"WS",value:"WS"},{label:"邮件",value:"EMAIL"},{label:"微信",value:"WX"}],C={name:"MsgType",components:{SearchForm:w["a"],TagsInput:x,AvatarUpload:_["a"]},data:function(){var e=this;return{description:"",form:this.$form.createForm(this),rowBtnSize:"small",loading:!1,columns:[{title:"图标",dataIndex:"logo",align:"center",scopedSlots:{customRender:"logo"}},{title:"编码",dataIndex:"id"},{title:"标题",dataIndex:"name"},{title:"推送方式",dataIndex:"pushMode"},{title:"过期天数",dataIndex:"expiry"},{title:"作废天数",dataIndex:"dead"},{title:"状态",dataIndex:"state",align:"center",scopedSlots:{customRender:"state"}},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],data:[],pushMode:S,searchFields:[{name:"标题",code:"search_LIKE_name"},{name:"编码",code:"search_LIKE_id"},{name:"推送方式",code:"search_LIKE_push_mode",type:"select",list:S},{name:"状态",code:"search_LIKE_state",type:"radio",list:[{label:"启用",value:"ON"},{label:"禁用",value:"OFF"}]}],pagination:{showSizeChanger:!0,total:0,current:1,pageSize:10},filter:{},modal:k,formItemLayout:{labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:21}}},formItemLayout2:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}},tagsInputConfirmCbk:function(t){return!(!t.startsWith("user:")&&!t.startsWith("role:"))||(e.$message.error("受众必须 是 user: 或 role: 开头的字符"),!1)}}},created:function(){this.loadData()},methods:{loadData:function(){var e=this;this.loading=!0;var t={filter:this.filter,current:this.pagination.current,pageSize:this.pagination.pageSize};n(t).then((function(t){e.data=t.data.records,e.pagination.current=t.data.current,e.pagination.total=t.data.total,e.pagination.pageSize=t.data.pageSize})).finally((function(){e.loading=!1}))},handleSearchEvent:function(e){this.pagination.current=1,this.pagination.total=0,this.filter=e,this.loadData()},handleChange:function(e){this.pagination=e,this.loadData()},toggleState:function(e){var t=this;u(e.id).then((function(e){e.status&&t.loadData()}))},handleAdd:function(){var e=this;this.modal.title="新增",this.modal.mode="add",this.modal.visible=!0,this.modal.form.logo="",this.modal.form.logoLoading=!1,this.$nextTick((function(){e.form.setFieldsValue({state:"ON",pushMode:"WS",expiry:10,dead:10})}))},handleEdit:function(e){var t=this;this.modal.title="编辑",this.modal.mode="edit",this.modal.visible=!0,this.modal.form.logo=e.logo,this.modal.form.audience=e.audience.split(","),this.modal.form.logoLoading=!1,this.$nextTick((function(){t.form.setFieldsValue({id:e.id,name:e.name,cate:e.cate,pushMode:e.pushMode,template:e.template,state:e.state,expiry:e.expiry,dead:e.dead,remark:e.remark})}))},handleRemove:function(e){var t=this;c(e).then((function(e){e.status&&t.loadData()}))},handleModalOk:function(){var e=this;this.form.validateFields((function(t,a){t||(delete a.imgFile,a.logo=e.modal.form.logo,a.audience=e.modal.form.audience,e.modal.confirmLoading=!0,"add"===e.modal.mode?l(a).then(e.handleModalOkResult):"edit"===e.modal.mode&&d(a.id,a).then(e.handleModalOkResult))}))},handleModalOkResult:function(e){this.modal.confirmLoading=!1,e.status&&(this.modal.visible=!1,this.form.resetFields(),this.loadData())},handleModalCancel:function(){this.form.resetFields(),this.modal.form.audience=[],this.modal.visible=!1}}},I=C,F=Object(b["a"])(I,r,o,!1,null,null,null);t["default"]=F.exports}}]);